<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>LotBlox Manager V12</title>
    <style>
      :root {
        color-scheme: dark;
        --bg: #050814;
        --card: #0b1020;
        --accent: #4f46e5;
        --accent-soft: rgba(79, 70, 229, 0.18);
        --text: #e5e7eb;
        --muted: #9ca3af;
        --danger: #f97373;
        --success: #4ade80;
        --border: rgba(148, 163, 184, 0.25);
      }
      * { box-sizing: border-box; }
      body {
        margin: 0; padding: 12px; width: 340px; min-height: 260px;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: radial-gradient(circle at top, #111827 0, #020617 45%, #000 100%);
        color: var(--text);
      }
      .card {
        background: radial-gradient(circle at top left, #111827 0, #020617 55%);
        border-radius: 14px; padding: 12px; border: 1px solid var(--border);
        box-shadow: 0 18px 50px rgba(15, 23, 42, 0.9), 0 0 0 1px rgba(15, 23, 42, 0.7);
      }
      .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
      .title { font-size: 14px; font-weight: 600; }
      .badge { font-size: 11px; padding: 2px 6px; border-radius: 999px; background: var(--accent-soft); color: var(--accent); border: 1px solid rgba(79, 70, 229, 0.6); }
      .subtitle { font-size: 11px; color: var(--muted); margin-bottom: 10px; }
      .section-label { font-size: 11px; text-transform: uppercase; letter-spacing: 0.08em; color: var(--muted); margin-bottom: 6px; }
      .status-row { display: flex; justify-content: space-between; align-items: center; padding: 6px 8px; border-radius: 10px; background: rgba(15, 23, 42, 0.9); border: 1px solid rgba(31, 41, 55, 0.9); margin-bottom: 8px; }
      .status-left { display: flex; flex-direction: column; gap: 2px; }
      .status-label { font-size: 12px; }
      .status-meta { font-size: 11px; color: var(--muted); }
      .pill { font-size: 11px; padding: 2px 8px; border-radius: 999px; border: 1px solid rgba(148, 163, 184, 0.5); color: var(--muted); }
      .pill.success { border-color: rgba(74, 222, 128, 0.9); color: var(--success); }
      .pill.danger { border-color: rgba(248, 113, 113, 0.9); color: var(--danger); }
      .btn-row { display: flex; gap: 6px; margin-top: 4px; margin-bottom: 6px; }
      button {
        all: unset; cursor: pointer; text-align: center; padding: 6px 10px; border-radius: 999px; font-size: 12px;
        border: 1px solid rgba(148, 163, 184, 0.5); color: var(--text); background: linear-gradient(135deg, #020617, #020617);
        flex: 1; transition: transform 0.1s ease-out, box-shadow 0.1s ease-out, border-color 0.1s ease-out, background 0.1s ease-out;
      }
      button.primary {
        background: radial-gradient(circle at top left, #4f46e5 0, #4338ca 40%, #020617 100%);
        border-color: rgba(79, 70, 229, 0.9); box-shadow: 0 0 25px rgba(79, 70, 229, 0.45), 0 10px 25px rgba(15, 23, 42, 0.9);
      }
      button:hover { transform: translateY(-1px); border-color: rgba(148, 163, 184, 0.9); }
      button.primary:hover { box-shadow: 0 0 32px rgba(79, 70, 229, 0.6), 0 12px 28px rgba(15, 23, 42, 0.95); }
      .footer { margin-top: 6px; display: flex; justify-content: space-between; align-items: center; font-size: 10px; color: var(--muted); }
      .dot { width: 7px; height: 7px; border-radius: 999px; margin-right: 4px; background: radial-gradient(circle at center, #4ade80 0, #15803d 60%, #052e16 100%); box-shadow: 0 0 10px rgba(74, 222, 128, 0.9); }
      .footer-left { display: flex; align-items: center; gap: 3px; }
      .link { text-decoration: underline; cursor: pointer; }
    </style>
  </head>
  <body>
    <div class="card">
      <div class="header">
        <div class="title">LotBlox Manager V12</div>
        <span class="badge">Vault Edition</span>
      </div>
      <div class="subtitle">Quick actions and live status for your Roblox vault and profile auto-fixer.</div>
      <div class="section-label">Vault & profile</div>
      <div class="status-row">
        <div class="status-left">
          <span class="status-label">Vault status</span>
          <span class="status-meta" id="vault-meta">Checking current Roblox tab...</span>
        </div>
        <span class="pill" id="vault-pill">Unknown</span>
      </div>
      <div class="status-row">
        <div class="status-left">
          <span class="status-label">Profile auto-fixer</span>
          <span class="status-meta" id="profile-meta">Idle</span>
        </div>
        <span class="pill success" id="profile-pill">Ready</span>
      </div>
      <div class="btn-row">
        <button class="primary" id="fix-profile-btn">Run Auto-Fix</button>
        <button id="open-vault-btn">Open Vault Panel</button>
      </div>
      <div class="btn-row">
        <button id="refresh-status-btn">Refresh Status</button>
      </div>
      <div class="footer">
        <div class="footer-left">
          <span class="dot"></span>
          <span id="footer-status">Waiting on Roblox tab...</span>
        </div>
        <span id="settings-link" class="link">Settings</span>
      </div>
    </div>
    <script>
      async function getActiveRobloxTab() {
        const [tab] = await chrome.tabs.query({
          active: true,
          currentWindow: true,
          url: ["*://*.roblox.com/*"],
        });
        return tab || null;
      }
      async function pingContent(tabId) {
        try {
          const res = await chrome.tabs.sendMessage(tabId, { type: "LOTBLOX_PING" });
          return res || null;
        } catch (e) {
          return null;
        }
      }
      function setVaultState(state, meta) {
        const pill = document.getElementById("vault-pill");
        const metaEl = document.getElementById("vault-meta");
        metaEl.textContent = meta;
        pill.classList.remove("success", "danger");
        if (state === "ok") {
          pill.classList.add("success");
          pill.textContent = "Secure";
        } else if (state === "warn") {
          pill.classList.add("danger");
          pill.textContent = "Attention";
        } else {
          pill.textContent = "Unknown";
        }
      }
      function setFooter(text) {
        document.getElementById("footer-status").textContent = text;
      }
      async function refreshStatus() {
        setFooter("Checking Roblox tab...");
        setVaultState("unknown", "Checking current Roblox tab...");
        const tab = await getActiveRobloxTab();
        if (!tab) {
          setVaultState("unknown", "Open any roblox.com page and click the icon again.");
          setFooter("No Roblox tab detected.");
          return;
        }
        const res = await pingContent(tab.id);
        if (!res) {
          setVaultState("warn", "Content script not responding. Reload the page then press Refresh.");
          setFooter("Content script not detected.");
          return;
        }
        if (res.vaultSecure) {
          setVaultState("ok", "Vault is locked and profile appears healthy.");
          setFooter("Vault secure.");
        } else {
          setVaultState("warn", "Vault or profile needs attention. Run Auto-Fix.");
          setFooter("Issues detected.");
        }
        if (res.profileStatus) {
          document.getElementById("profile-meta").textContent = res.profileStatus;
        }
      }
      document.getElementById("fix-profile-btn").addEventListener("click", async () => {
        const tab = await getActiveRobloxTab();
        if (!tab) { alert("Please open a Roblox page first."); return; }
        setFooter("Running auto-fix...");
        await chrome.tabs.sendMessage(tab.id, { type: "RUN_AUTO_FIX" });
        setTimeout(refreshStatus, 1000);
      });
      document.getElementById("open-vault-btn").addEventListener("click", async () => {
        const tab = await getActiveRobloxTab();
        if (!tab) { alert("Please open a Roblox page first."); return; }
        await chrome.tabs.sendMessage(tab.id, { type: "OPEN_VAULT" });
      });
      document.getElementById("refresh-status-btn").addEventListener("click", refreshStatus);
      document.getElementById("settings-link").addEventListener("click", () => {
        chrome.runtime.openOptionsPage();
      });
      refreshStatus();
    </script>
  </body>
</html>
